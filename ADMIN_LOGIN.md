# ç®¡ç†å‘˜ç™»å½•æŒ‡å—

## é»˜è®¤ç®¡ç†å‘˜è´¦å·

ç³»ç»Ÿæä¾›äº†é»˜è®¤çš„ç®¡ç†å‘˜è´¦å·ï¼š

```
ç”¨æˆ·å: aita
å¯†ç : aita
é‚®ç®±: aita@admin.com
```

---

## ç™»å½•æ­¥éª¤

### æ–¹å¼1: é€šè¿‡Webç•Œé¢ç™»å½•

1. æ‰“å¼€æ¸¸æˆç½‘é¡µ
2. åœ¨ç™»å½•ç•Œé¢è¾“å…¥ï¼š
   - **ç”¨æˆ·å/é‚®ç®±**: `aita@admin.com` æˆ– `aita`
   - **å¯†ç **: `aita`
3. ç‚¹å‡» "ç™»å½•" æŒ‰é’®
4. ç™»å½•æˆåŠŸåè¿›å…¥å¤§å…
5. ç‚¹å‡»å³ä¸Šè§’ âš™ï¸ è®¾ç½®å›¾æ ‡
6. åœ¨è®¾ç½®é¢æ¿ä¸­å¯ä»¥çœ‹åˆ°ç®¡ç†å‘˜ä¸“å±æŒ‰é’®ï¼š
   - ğŸ´ å¡ç‰Œæ•°æ®åº“
   - ğŸ“ ç©å®¶å­˜æ¡£

### æ–¹å¼2: é€šè¿‡APIç™»å½•ï¼ˆæµ‹è¯•ç”¨ï¼‰

```bash
curl -X POST http://localhost:3000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"aita@admin.com","password":"aita"}'
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "user": {
    "id": 1,
    "email": "aita@admin.com",
    "username": "aita"
  },
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
```

---

## åˆ›å»ºç®¡ç†å‘˜è´¦å·

### è‡ªåŠ¨åˆ›å»ºï¼ˆé¦–æ¬¡å¯åŠ¨ï¼‰

å¦‚æœæ•°æ®åº“ä¸­æ²¡æœ‰ç®¡ç†å‘˜è´¦å·ï¼Œå¯ä»¥è¿è¡Œåˆ›å»ºè„šæœ¬ï¼š

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ
npm run admin:create
```

æˆ–è€…ï¼š

```bash
node server/db/create-admin.js
```

**è„šæœ¬ä¼šï¼š**
- âœ… åˆ›å»ºç”¨æˆ·åä¸º `aita` çš„ç®¡ç†å‘˜è´¦å·
- âœ… è®¾ç½®è§’è‰²ä¸º `admin`
- âœ… åˆå§‹åŒ–ç®¡ç†å‘˜æ•°æ®ï¼ˆ50æ ¼èƒŒåŒ…ï¼Œ9999èµ„æºï¼‰
- âœ… è§£é”æ‰€æœ‰å¡ç‰Œï¼ˆæ¯å¼ 10ä¸ªï¼‰

**è¾“å‡ºç¤ºä¾‹ï¼š**
```
âœ… ç®¡ç†å‘˜è´¦æˆ·åˆ›å»ºæˆåŠŸ
   ç”¨æˆ·å: aita
   å¯†ç : aita
   é‚®ç®±: aita@admin.com
```

### æ‰‹åŠ¨åˆ›å»ºç®¡ç†å‘˜

å¦‚æœéœ€è¦åˆ›å»ºé¢å¤–çš„ç®¡ç†å‘˜è´¦å·ï¼š

#### æ–¹æ³•1: é€šè¿‡æ•°æ®åº“

```sql
-- 1. æ³¨å†Œæ™®é€šè´¦å·ï¼ˆé€šè¿‡Webç•Œé¢æˆ–APIï¼‰
-- 2. åœ¨æ•°æ®åº“ä¸­å°†è§’è‰²æ”¹ä¸ºç®¡ç†å‘˜

UPDATE users 
SET role = 'admin' 
WHERE username = 'ä½ çš„ç”¨æˆ·å';
```

#### æ–¹æ³•2: ä¿®æ”¹åˆ›å»ºè„šæœ¬

ç¼–è¾‘ `server/db/create-admin.js`:

```javascript
const adminEmail = 'your@email.com';
const adminUsername = 'yourusername';
const adminPassword = 'yourpassword';
```

ç„¶åè¿è¡Œï¼š
```bash
node server/db/create-admin.js
```

---

## éªŒè¯ç®¡ç†å‘˜èº«ä»½

### æ–¹æ³•1: æŸ¥çœ‹è®¾ç½®é¢æ¿

ç®¡ç†å‘˜ç™»å½•åï¼š
- å¤§å…å³ä¸Šè§’ âš™ï¸ è®¾ç½®
- èƒ½çœ‹åˆ° "ğŸ´ å¡ç‰Œæ•°æ®åº“" å’Œ "ğŸ“ ç©å®¶å­˜æ¡£" æŒ‰é’®
- æ™®é€šç”¨æˆ·çœ‹ä¸åˆ°è¿™äº›æŒ‰é’®

### æ–¹æ³•2: æŸ¥è¯¢æ•°æ®åº“

```sql
SELECT id, username, email, role 
FROM users 
WHERE role = 'admin';
```

**é¢„æœŸç»“æœï¼š**
```
 id | username |      email       | role  
----+----------+------------------+-------
  1 | aita     | aita@admin.com   | admin
```

### æ–¹æ³•3: è°ƒç”¨ç®¡ç†å‘˜API

```bash
# å…ˆç™»å½•è·å–token
TOKEN="your_jwt_token_here"

# æµ‹è¯•ç®¡ç†å‘˜æƒé™
curl -X GET http://localhost:3000/api/admin/dashboard \
  -H "Authorization: Bearer $TOKEN"
```

å¦‚æœè¿”å›403é”™è¯¯ï¼Œè¯´æ˜ä¸æ˜¯ç®¡ç†å‘˜è´¦å·ã€‚

---

## ç®¡ç†å‘˜åŠŸèƒ½

### 1. å¡ç‰Œæ•°æ®åº“ç®¡ç†

**è®¿é—®è·¯å¾„:** å¤§å… â†’ âš™ï¸ è®¾ç½® â†’ ğŸ´ å¡ç‰Œæ•°æ®åº“

**åŠŸèƒ½ï¼š**
- æŸ¥çœ‹æ‰€æœ‰å¡ç‰Œï¼ˆç³»ç»Ÿå¡ + ç”¨æˆ·ç”Ÿæˆå¡ï¼‰
- æŒ‰æ—¶ä»£ã€ç±»å‹ã€æ¥æºç­›é€‰
- åˆ›å»ºæ–°çš„åŸºç¡€å¡ç‰Œ
- ç¼–è¾‘å¡ç‰Œå±æ€§
- åˆ é™¤å¡ç‰Œï¼ˆç”¨æˆ·ç”Ÿæˆå¡å—ä¿æŠ¤ï¼‰
- æ‰¹é‡å¯¼å…¥å¡ç‰Œ
- å®æ—¶ç»Ÿè®¡

**è¯¦ç»†æ–‡æ¡£:** `docs/å¡ç‰Œç®¡ç†ä½¿ç”¨æŒ‡å—.md`

### 2. ç©å®¶å­˜æ¡£ç®¡ç†

**è®¿é—®è·¯å¾„:** å¤§å… â†’ âš™ï¸ è®¾ç½® â†’ ğŸ“ ç©å®¶å­˜æ¡£

**åŠŸèƒ½ï¼š**
- æŸ¥çœ‹æ‰€æœ‰ç©å®¶åˆ—è¡¨
- æœç´¢ç©å®¶ï¼ˆç”¨æˆ·å/é‚®ç®±ï¼‰
- æŸ¥çœ‹ç©å®¶è¯¦ç»†æ•°æ®
- åˆ é™¤ç©å®¶å­˜æ¡£
- æ‰¹é‡åˆ é™¤
- é‡ç½®ç©å®¶è¿›åº¦

**è¯¦ç»†æ–‡æ¡£:** `PLAYER_ARCHIVES_ADMIN.md`

### 3. å…¶ä»–ç®¡ç†åŠŸèƒ½ï¼ˆé¢„ç•™ï¼‰

**APIç«¯ç‚¹ï¼š**
- `GET /api/admin/dashboard` - ç»Ÿè®¡æ•°æ®
- `GET /api/admin/users` - ç”¨æˆ·åˆ—è¡¨
- `PUT /api/admin/users/:userId/role` - ä¿®æ”¹ç”¨æˆ·è§’è‰²
- `POST /api/admin/users/:userId/resources` - ä¿®æ”¹ç”¨æˆ·èµ„æº
- `DELETE /api/admin/cleanup/test` - æ¸…ç†æµ‹è¯•æ•°æ®

---

## å®‰å…¨æ³¨æ„äº‹é¡¹

### 1. ä¿®æ”¹é»˜è®¤å¯†ç 

âš ï¸ **å¼ºçƒˆå»ºè®®ä¿®æ”¹é»˜è®¤ç®¡ç†å‘˜å¯†ç ï¼**

**æ–¹æ³•1: é€šè¿‡æ•°æ®åº“**

```javascript
// ä½¿ç”¨ argon2 ç”Ÿæˆæ–°å¯†ç å“ˆå¸Œ
import argon2 from 'argon2';

const newPassword = 'ä½ çš„æ–°å¯†ç ';
const passwordHash = await argon2.hash(newPassword);

// åœ¨æ•°æ®åº“ä¸­æ›´æ–°
UPDATE users 
SET password_hash = 'ç”Ÿæˆçš„å“ˆå¸Œå€¼' 
WHERE username = 'aita';
```

**æ–¹æ³•2: åˆ›å»ºæ–°ç®¡ç†å‘˜ååˆ é™¤é»˜è®¤è´¦å·**

```sql
-- 1. åˆ›å»ºæ–°ç®¡ç†å‘˜è´¦å·ï¼ˆä½¿ç”¨ä¸Šé¢çš„æ–¹æ³•ï¼‰
-- 2. åˆ é™¤é»˜è®¤è´¦å·
DELETE FROM users WHERE username = 'aita';
```

### 2. é™åˆ¶ç®¡ç†å‘˜æƒé™

```sql
-- æŸ¥çœ‹æ‰€æœ‰ç®¡ç†å‘˜
SELECT username, email, created_at 
FROM users 
WHERE role = 'admin';

-- å–æ¶ˆç®¡ç†å‘˜æƒé™
UPDATE users 
SET role = 'user' 
WHERE username = 'è¦é™çº§çš„ç”¨æˆ·å';
```

### 3. ç®¡ç†å‘˜è´¦å·ä¿æŠ¤

- âœ… ç®¡ç†å‘˜è´¦å·ä¸èƒ½é€šè¿‡ç®¡ç†é¢æ¿åˆ é™¤
- âœ… æ‰¹é‡åˆ é™¤æ—¶è‡ªåŠ¨æ’é™¤ç®¡ç†å‘˜
- âœ… æ‰€æœ‰ç®¡ç†æ“ä½œéƒ½æœ‰æ—¥å¿—è®°å½•

---

## æ•…éšœæ’æŸ¥

### é—®é¢˜1: ç®¡ç†å‘˜è´¦å·ä¸å­˜åœ¨

**ç—‡çŠ¶:** æ— æ³•ä½¿ç”¨ `aita` ç™»å½•

**è§£å†³:**
```bash
npm run admin:create
```

### é—®é¢˜2: ç™»å½•åçœ‹ä¸åˆ°ç®¡ç†å‘˜æŒ‰é’®

**æ£€æŸ¥è§’è‰²:**
```sql
SELECT role FROM users WHERE username = 'aita';
```

**å¦‚æœä¸æ˜¯ adminï¼Œä¿®å¤:**
```sql
UPDATE users SET role = 'admin' WHERE username = 'aita';
```

### é—®é¢˜3: APIè¿”å›403 Forbidden

**å¯èƒ½åŸå› :**
- Tokenè¿‡æœŸ
- ç”¨æˆ·ä¸æ˜¯ç®¡ç†å‘˜
- ä¸­é—´ä»¶æœªæ­£ç¡®é…ç½®

**æµ‹è¯•:**
```bash
# 1. é‡æ–°ç™»å½•è·å–æ–°token
# 2. æ£€æŸ¥æ•°æ®åº“roleå­—æ®µ
# 3. æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—
```

### é—®é¢˜4: å¿˜è®°ç®¡ç†å‘˜å¯†ç 

**é‡ç½®å¯†ç :**
```bash
# åˆ é™¤ç°æœ‰ç®¡ç†å‘˜
psql -d minigame -c "DELETE FROM users WHERE username = 'aita';"

# é‡æ–°åˆ›å»º
npm run admin:create
```

æˆ–è€…ç›´æ¥åœ¨æ•°æ®åº“ä¸­æ›´æ–°å¯†ç å“ˆå¸Œï¼ˆè§ä¸Šé¢"ä¿®æ”¹é»˜è®¤å¯†ç "ï¼‰

---

## æµ‹è¯•è„šæœ¬

é¡¹ç›®æä¾›äº†ç®¡ç†å‘˜åŠŸèƒ½æµ‹è¯•è„šæœ¬ï¼š

```bash
# æµ‹è¯•ç®¡ç†å‘˜API
./test-admin.sh
```

**è„šæœ¬å†…å®¹ï¼š**
```bash
#!/bin/bash

# ç™»å½•ç®¡ç†å‘˜
ADMIN_LOGIN=$(curl -s -X POST http://localhost:3000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"aita@admin.com","password":"aita"}')

echo "ç®¡ç†å‘˜ç™»å½•å“åº”:"
echo $ADMIN_LOGIN

# æå–token
TOKEN=$(echo $ADMIN_LOGIN | grep -o '"token":"[^"]*"' | cut -d'"' -f4)

# æµ‹è¯•ç®¡ç†å‘˜Dashboard
echo -e "\n\næµ‹è¯•ç®¡ç†å‘˜Dashboard:"
curl -s -X GET http://localhost:3000/api/admin/dashboard \
  -H "Authorization: Bearer $TOKEN" | jq .

# æµ‹è¯•å¡ç‰Œæ•°æ®åº“
echo -e "\n\næµ‹è¯•å¡ç‰Œæ•°æ®åº“:"
curl -s -X GET http://localhost:3000/api/cards-database/ \
  -H "Authorization: Bearer $TOKEN" | jq .
```

---

## ç¯å¢ƒå˜é‡

ç®¡ç†å‘˜åŠŸèƒ½éœ€è¦æ­£ç¡®é…ç½®JWTå¯†é’¥ï¼š

```bash
# .env
JWT_SECRET=your-secret-key-here
JWT_EXPIRES_IN=7d
```

å¦‚æœJWT_SECRETæœªè®¾ç½®ï¼Œç³»ç»Ÿä¼šä½¿ç”¨é»˜è®¤å€¼ï¼ˆä¸æ¨èç”Ÿäº§ç¯å¢ƒï¼‰ã€‚

---

## æ€»ç»“

### å¿«é€Ÿå¼€å§‹

```bash
# 1. åˆ›å»ºç®¡ç†å‘˜è´¦å·
npm run admin:create

# 2. å¯åŠ¨æœåŠ¡
npm start

# 3. è®¿é—®æ¸¸æˆç½‘é¡µ
# 4. ä½¿ç”¨ aita / aita ç™»å½•
# 5. ç‚¹å‡»è®¾ç½®æŸ¥çœ‹ç®¡ç†å‘˜åŠŸèƒ½
```

### é»˜è®¤å‡­è¯

```
ç”¨æˆ·å: aita
å¯†ç : aita
é‚®ç®±: aita@admin.com
```

### ç®¡ç†å‘˜åŠŸèƒ½å…¥å£

```
å¤§å… â†’ âš™ï¸ è®¾ç½® â†’ ç®¡ç†å‘˜æŒ‰é’®
  â”œâ”€ ğŸ´ å¡ç‰Œæ•°æ®åº“
  â””â”€ ğŸ“ ç©å®¶å­˜æ¡£
```

### å®‰å…¨æé†’

âš ï¸ **ç”Ÿäº§ç¯å¢ƒå¿…é¡»ï¼š**
1. ä¿®æ”¹é»˜è®¤ç®¡ç†å‘˜å¯†ç 
2. è®¾ç½®å¼ºJWTå¯†é’¥
3. å¯ç”¨HTTPS
4. é…ç½®é˜²ç«å¢™è§„åˆ™
5. å®šæœŸå®¡è®¡ç®¡ç†å‘˜æ“ä½œæ—¥å¿—

