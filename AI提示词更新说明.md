# AI提示词更新说明

## 更新内容

已成功添加「AI文明名称」字段到卡牌系统，并更新了AI合成提示词。

## 数据库变更

### 新增字段
- `cards.ai_civilization_name` (VARCHAR(50)): AI合成时使用的文明名称

### 数据示例
| 卡牌名称 | 所属时代 | AI文明名称 |
|---------|---------|-----------|
| 水      | 生存时代 | 石器时代   |
| 火      | 生存时代 | 石器时代   |
| 符号    | 城邦时代 | 城邦时代   |
| 矿石    | 城邦时代 | 城邦时代   |

## AI提示词更新

### 原提示词格式
```
我在做一个游戏，我需要你用json格式回复我：{水}和{火}可以合成什么东西
```

### 新提示词格式
```
我在做一个游戏，我需要你用json格式回复我：{水}和{火}在{石器时代}可以合成什么东西
```

### 返回格式更新

**旧格式：**
```json
{
  "combinations": [
    {"results": "蒸汽", "prompt": "水蒸气效果图"}
  ]
}
```

**新格式：**
```json
{
  "combinations": [
    {"name": "蒸汽", "prompt": "水蒸气效果图"}
  ]
}
```

**注意：** 代码已保持向后兼容，同时支持旧的 `results` 字段和新的 `name` 字段。

## 提示词完整要求

AI合成时的提示词包含以下内容：

1. **基础合成语句**：`{卡牌1}和{卡牌2}在{AI文明名称}可以合成什么东西`
2. **创作范围**：可以是现实的、魔法的、科幻的、魔幻的等等所有能想象到的内容
3. **职业影响**：如果有职业，会加入职业偏好信息
4. **时代限制**：包含当前时代的科技限制和禁止概念
5. **返回格式**：
   - 至少给出3个不同的合成结果
   - 每个结果包含 `name` 和 `prompt` 字段
   - name: 合成物名称（中文）
   - prompt: 简单的生图提示词（中文）

## 使用方法

### 重新导入卡牌数据

如果有新的CSV文件需要导入：

```bash
node import-cards-from-csv.js "数值体系 - 卡牌 (2).csv"
```

### CSV文件格式

必须包含以下列：
- 排序
- 卡牌名称
- 卡牌类型
- 所属文明
- 获取方式
- 设计阐述
- 困境
- **AI文明名称** (新增)

## 技术实现

### 代码变更

1. **数据库层** (`add-ai-civilization-field.sql`)
   - 添加 `ai_civilization_name` 字段

2. **导入脚本** (`import-cards-from-csv.js`)
   - 支持读取CSV中的「AI文明名称」列
   - 导入时填充该字段

3. **合成服务** (`server/services/synthService.js`)
   - 修改 `getInputItems` 函数
   - 从cards表查询卡牌时获取 `ai_civilization_name`

4. **AI服务** (`server/services/aiService.js`)
   - 使用卡牌的 `ai_civilization_name` 替代 `currentEra`
   - 更新提示词模板：在{AI文明名称}可以合成什么
   - 支持新的返回格式 `{name, prompt}`
   - 保持向后兼容 `{results, prompt}`

## 文件清单

- `import-cards-from-csv.js` - 卡牌导入脚本（已更新）
- `server/services/aiService.js` - AI服务（已更新）
- `server/services/synthService.js` - 合成服务（已更新）
- `数值体系 - 卡牌 (2).csv` - 包含AI文明名称的卡牌数据
- `AI提示词更新说明.md` - 本文档

## 验证

导入90张卡牌成功：
- 生存时代卡牌 → AI文明名称：石器时代
- 城邦时代卡牌 → AI文明名称：城邦时代
- 分野时代卡牌 → AI文明名称：分野时代
- 帝国时代卡牌 → AI文明名称：帝国时代
- （其他时代类推）

## 示例

### 合成示例1
**输入卡牌**：水、火  
**AI文明名称**：石器时代  
**提示词**：{水}和{火}在{石器时代}可以合成什么东西

**可能返回**：
```json
{
  "combinations": [
    {"name": "蒸汽", "prompt": "原始人看着沸腾的水冒出白色蒸汽"},
    {"name": "热水", "prompt": "石器时代的陶罐中冒着热气的水"},
    {"name": "烟雾", "prompt": "火焰遇水产生的浓烟"}
  ]
}
```

### 合成示例2
**输入卡牌**：符号、矿石  
**AI文明名称**：城邦时代  
**提示词**：{符号}和{矿石}在{城邦时代}可以合成什么东西

**可能返回**：
```json
{
  "combinations": [
    {"name": "铭文", "prompt": "刻在青铜器上的古代文字"},
    {"name": "货币", "prompt": "带有符号标记的金属币"},
    {"name": "印章", "prompt": "雕刻着符号的石印"}
  ]
}
```

