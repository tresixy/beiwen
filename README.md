# AI é©±åŠ¨çš„æ— é™åˆæˆèµ„æºç½‘é¡µæ¸¸æˆ

ä¸€ä¸ªåŸºäº Phaser 3 çš„å›åˆåˆ¶åˆæˆæ¸¸æˆï¼Œæ”¯æŒ AI ç”Ÿæˆåˆæˆè§„åˆ™å’Œç‰©å“ã€‚

## âœ¨ ç‰¹æ€§

- ğŸ® å›åˆåˆ¶åˆæˆç©æ³•ï¼šæŠ½ç‰Œã€åˆæˆã€ä¸–ç•ŒåŒ–å½¢ã€å›åˆç»“ç®—
- ğŸ¤– AI é©±åŠ¨ï¼ˆå¯é€‰ï¼‰ï¼šä½¿ç”¨ OpenAI ç”Ÿæˆåˆ›æ„åˆæˆç»“æœ
- ğŸ´ å¡ç‰Œç³»ç»Ÿï¼šé›†ä½“è®°å¿†ç‰Œåº“ã€ç¨€æœ‰åº¦ã€å±æ€§ç³»ç»Ÿ
- ğŸŒ ä¸–ç•Œæ²™ç›˜ï¼šåœ°å—ã€å»ºç­‘ã€å•ä½ç³»ç»Ÿ
- ğŸ“Š èµ„æºç®¡ç†ï¼šé£Ÿç‰©ã€ç”Ÿäº§åŠ›ã€ç ”ç©¶ç‚¹
- ğŸ”– ç¤¾ä¼šå¥‘çº¦ï¼šåˆ†æ”¯é€‰æ‹©å½±å“æ–‡æ˜è·¯çº¿
- â° **æ—¶ä»£ç³»ç»Ÿ**ï¼š7ä¸ªæ—¶ä»£ï¼Œç§‘æŠ€é™åˆ¶ï¼Œé˜²æ­¢è¶…æ—¶ä»£åˆæˆ â­ï¸æ–°å¢
- ğŸ¯ **EventsæŒ‘æˆ˜**ï¼š20ä¸ªéšæœºeventsï¼Œæ¯å±€ä¸åŒï¼Œæ¨åŠ¨æ–‡æ˜è¿›ç¨‹ â­ï¸æ–°å¢
- ğŸ“± ç§»åŠ¨ç«¯æ”¯æŒï¼šè™šæ‹Ÿæ‘‡æ†ã€å“åº”å¼ HUD
- ğŸ¨ æ·±è‰²æ¸¸æˆåŒ– UIï¼šæ¶²æ€æ¯›ç»ç’ƒã€æ¸å˜æ•ˆæœ

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹å¼ä¸€ï¼šè‡ªåŠ¨å®‰è£…ï¼ˆæ¨èï¼‰

```bash
# 1. è¿›å…¥é¡¹ç›®ç›®å½•
cd /root/minigame

# 2. è¿è¡Œè®¾ç½®è„šæœ¬ï¼ˆè‡ªåŠ¨å®‰è£…PostgreSQLã€Rediså¹¶åˆå§‹åŒ–æ•°æ®åº“ï¼‰
./setup.sh

# 3. é…ç½® Nginx åå‘ä»£ç†ï¼ˆå¯é€‰ï¼‰
./setup-nginx.sh

# 4. å¯åŠ¨æ¸¸æˆæœåŠ¡å™¨
./start.sh
```

**è®¿é—®åœ°å€**:
- ä½¿ç”¨ Nginx: http://localhost
- ç›´æ¥è®¿é—®: http://localhost:3000

### æ–¹å¼äºŒï¼šæ‰‹åŠ¨å®‰è£…

#### ç¯å¢ƒè¦æ±‚
- Node.js >= 20
- PostgreSQL >= 14
- Redis >= 6

#### 1. å®‰è£…ä¾èµ–
```bash
npm install
npm --prefix client install
```

#### 2. é…ç½®ç¯å¢ƒå˜é‡
```bash
# .env æ–‡ä»¶å·²è‡ªåŠ¨åˆ›å»ºï¼Œå¯æ ¹æ®éœ€è¦ä¿®æ”¹
# ä¸»è¦é…ç½®é¡¹ï¼š
# - DATABASE_URL: PostgreSQL è¿æ¥å­—ç¬¦ä¸²
# - REDIS_URL: Redis è¿æ¥å­—ç¬¦ä¸²
# - AI_ENABLED: æ˜¯å¦å¯ç”¨ AI åˆæˆï¼ˆéœ€è¦ OPENAI_API_KEYï¼‰
```

#### 3. åˆå§‹åŒ–æ•°æ®åº“
```bash
# ç¡®ä¿ PostgreSQL å’Œ Redis æ­£åœ¨è¿è¡Œ
sudo systemctl start postgresql
sudo systemctl start redis-server

# åˆ›å»ºæ•°æ®åº“
sudo -u postgres psql -c "CREATE DATABASE minigame;"

# åˆå§‹åŒ–è¡¨
sudo -u postgres psql -d minigame < server/db/schema.sql
```

#### 4. å¯åŠ¨æœåŠ¡å™¨
```bash
# å¼€å‘æ¨¡å¼ï¼ˆå‰åç«¯åˆ†ç¦»è¿è¡Œï¼‰
npm run dev           # åç«¯ APIï¼ˆ3000ç«¯å£ï¼‰
npm run client:dev    # å‰ç«¯ React/Vite å¼€å‘æœåŠ¡å™¨ï¼ˆé»˜è®¤ 8080 ç«¯å£ï¼‰

# ç”Ÿäº§æ¨¡å¼
npm run client:build  # æ„å»ºå‰ç«¯é™æ€èµ„æºåˆ° client/dist
npm start             # å¯åŠ¨ Expressï¼Œè‡ªåŠ¨æ‰˜ç®¡ client/dist
```

## ğŸ® æ¸¸æˆç©æ³•

### 1. æ³¨å†Œ/ç™»å½•
é¦–æ¬¡è®¿é—®éœ€è¦æ³¨å†Œè´¦å·ï¼Œå·²æœ‰è´¦å·å¯ç›´æ¥ç™»å½•ã€‚

### 2. å››é˜¶æ®µå›åˆå¾ªç¯

#### çµæ„Ÿæ¶Œç°
ç‚¹å‡»"æŠ½ç‰Œ"ä»é›†ä½“è®°å¿†ç‰Œåº“æŠ½å–å¡ç‰Œåˆ°æ‰‹ç‰Œã€‚

#### å¼•å¯¼åˆæˆ
1. é€‰æ‹© 2 å¼ æˆ–å¤šå¼ æ‰‹ç‰Œï¼ˆç‚¹å‡»å¡ç‰Œé€‰ä¸­ï¼‰
2. ç‚¹å‡»"åˆæˆ"æŒ‰é’®æ‰“å¼€æ€æƒ³ç†”ç‚‰
3. è¾“å…¥åˆæˆåç§°ï¼ˆå¦‚"è’¸æ±½å¼•æ“"ï¼‰
4. ç‚¹å‡»"åˆæˆ"ç”Ÿæˆæ–°ç‰©å“

#### ç°å®åŒ–å½¢
åˆæˆçš„ç‰©å“ä¼šè‡ªåŠ¨æ·»åŠ åˆ°èƒŒåŒ…ï¼Œå¯ä»¥åœ¨ä¸–ç•Œä¸­æ”¾ç½®å»ºç­‘æˆ–å•ä½ã€‚

#### å›åˆç»“ç®—
ç‚¹å‡»"ç»“æŸå›åˆ"è¿›è¡Œï¼š
- èµ„æºç»“ç®—ï¼ˆé£Ÿç‰©ã€ç”Ÿäº§åŠ›ã€ç ”ç©¶ç‚¹ï¼‰
- éšæœºäº‹ä»¶è§¦å‘
- å®ä¼Ÿå·¥ç¨‹è¿›åº¦æ¨è¿›
- ç¤¾ä¼šå¥‘çº¦é€‰æ‹©ï¼ˆæ¯10å›åˆï¼‰

### 3. èµ„æºç³»ç»Ÿ
- ğŸ– **é£Ÿç‰©**ï¼šç»´æŒå•ä½ï¼ŒåŸºç¡€äº§å‡º +5/å›åˆ
- âš™ï¸ **ç”Ÿäº§åŠ›**ï¼šå»ºé€ å»ºç­‘å’Œå·¥ç¨‹ï¼ŒåŸºç¡€äº§å‡º +3/å›åˆ
- ğŸ”¬ **ç ”ç©¶ç‚¹**ï¼šè§£é”ç§‘æŠ€å’Œè“å›¾ï¼ŒåŸºç¡€äº§å‡º +2/å›åˆ

### 4. æ—¶ä»£ä¸Eventsç³»ç»Ÿ â­ï¸ æ–°åŠŸèƒ½

#### æ—¶ä»£ç³»ç»Ÿ
ç©å®¶çš„æ–‡æ˜å‘å±•åˆ†ä¸º7ä¸ªæ—¶ä»£ï¼Œæ¯ä¸ªæ—¶ä»£é™åˆ¶å¯åˆæˆçš„ç§‘æŠ€ï¼š

1. **ç”Ÿå­˜æ—¶ä»£** - èŒèŠ½æœŸï¼Œåªèƒ½åˆæˆç®€å•å·¥å…·ï¼ˆæœ€é«˜ç­‰çº§2ï¼‰
2. **åŸé‚¦æ—¶ä»£** - å»ºç«‹ç¤¾ä¼šç»„ç»‡ï¼ˆæœ€é«˜ç­‰çº§4ï¼‰
3. **åˆ†é‡æ—¶ä»£** - é¢ä¸´æ–¹å‘é€‰æ‹©ï¼ˆæœ€é«˜ç­‰çº§5ï¼‰
4. **å¸å›½æ—¶ä»£** - ç–†åŸŸæ‰©å¼ ï¼ˆæœ€é«˜ç­‰çº§6ï¼‰
5. **ç†æ€§æ—¶ä»£** - ç§‘å­¦å…´èµ·ï¼ˆæœ€é«˜ç­‰çº§7ï¼‰
6. **ä¿¡ä»°æ—¶ä»£** - ç²¾ç¥ä½“ç³»åŒ–ï¼ˆæœ€é«˜ç­‰çº§7ï¼‰
7. **å¯è’™æ—¶ä»£** - æ–‡æ˜çªç ´ï¼ˆæœ€é«˜ç­‰çº§10ï¼‰

**ç§‘æŠ€é™åˆ¶ç¤ºä¾‹**ï¼š
- âŒ ç”Ÿå­˜æ—¶ä»£ä¸èƒ½åˆæˆï¼šç”µåŠ›ã€æœºå™¨ã€æ ¸èƒ½ã€é’¢é“
- âœ… å¯è’™æ—¶ä»£å¯ä»¥åˆæˆï¼šç”µåŠ›ã€ç°ä»£ç§‘æŠ€ã€åŒ–å­¦

#### EventsæŒ‘æˆ˜
æ¯å±€æ¸¸æˆä»æ¯ä¸ªæ—¶ä»£çš„eventsæ± ä¸­éšæœºé€‰æ‹©ä¸€ä¸ªæŒ‘æˆ˜ï¼š

- **ã€å¯’å†·ã€‘** - éœ€è¦é’¥åŒ™"ç«"ï¼Œå¥–åŠ±"ç¯ç«"
- **ã€é¥¥é¥¿ã€‘** - éœ€è¦é’¥åŒ™"å†œä¸š"ï¼Œå¥–åŠ±"éº¦ç”°"
- **ã€çº·äº‰ã€‘** - éœ€è¦é’¥åŒ™"å¾‹æ³•"ï¼Œå¥–åŠ±"çŸ³ç¢‘"
- ...å…±20ä¸ªevents

å®Œæˆeventåè‡ªåŠ¨è§£é”ä¸‹ä¸€ä¸ªï¼Œå¯èƒ½è¿›å…¥æ–°æ—¶ä»£ã€‚

è¯¦ç»†æ–‡æ¡£ï¼š[æ—¶ä»£ä¸eventsç³»ç»Ÿ](docs/æ—¶ä»£ä¸eventsç³»ç»Ÿ.md)

### 5. åˆæˆç³»ç»Ÿ

#### è§„åˆ™åˆæˆ
å†…ç½®åˆæˆè§„åˆ™ï¼ˆä¼˜å…ˆçº§æœ€é«˜ï¼‰ï¼š
- ç«ç„° + æ°´æµ = è’¸æ±½
- æ³¥åœŸ + æ°´æµ = æ³¥æµ†
- ç«ç„° + æ³¥åœŸ = é™¶å™¨
- çŸ³å¤´ + ç«ç„° = ç†”ç‚‰
- æœ¨æ + çŸ³å¤´ = æ–§å¤´
- é‡‘å± + ç«ç„° = é’¢é“
- èƒ½é‡ + é‡‘å± = æœºå™¨

#### AI åˆæˆ
å¯ç”¨ AI åï¼Œæœªå‘½ä¸­è§„åˆ™çš„åˆæˆä¼šç”± AI åˆ›é€ æ€§ç”Ÿæˆï¼š
- æ ¹æ®è¾“å…¥ç‰©å“ç‰¹æ€§åˆç†æ¨ç†
- ç”Ÿæˆç‰©å“åç§°ã€ç­‰çº§ã€å±æ€§ã€æè¿°
- **è‡ªåŠ¨è€ƒè™‘æ—¶ä»£é™åˆ¶**ï¼Œé¿å…è¶…æ—¶ä»£åˆæˆ
- ç»“æœç¼“å­˜ 7 å¤©

## ğŸ“Š æ•°æ®åº“ç»“æ„

ä¸»è¦è¡¨ï¼š
- `users` - ç”¨æˆ·è´¦å·
- `cards` - å¡ç‰Œæ¨¡æ¿
- `deck_cards` - ç”¨æˆ·ç‰Œåº“
- `items` - ç‰©å“
- `inventories` - èƒŒåŒ…
- `resources` - èµ„æº
- `entities` - ä¸–ç•Œå®ä½“
- `ai_recipes` - AI åˆæˆé…æ–¹ç¼“å­˜
- `user_game_state` - ç©å®¶æ¸¸æˆçŠ¶æ€ï¼ˆæ—¶ä»£ã€eventsè¿›åº¦ã€æ‰‹ç‰Œç­‰ï¼‰
- `events` - Eventså®šä¹‰ï¼ˆ20ä¸ªæŒ‘æˆ˜ï¼‰

### æ•°æ®åº“è¿ç§»

æŒ‰é¡ºåºè¿è¡Œä»¥ä¸‹è¿ç§»è„šæœ¬ï¼š

**1. æ—¶ä»£ä¸eventsç³»ç»Ÿ**
```bash
node server/db/run-migration.js
# æˆ–
sudo -u postgres psql -d minigame < server/db/migrations/add_era_and_events.sql
```

**2. ç”¨æˆ·ç”Ÿæˆå¡ç‰Œç³»ç»Ÿ**
```bash
node server/db/run-migration-user-cards.js
# æˆ–
sudo -u postgres psql -d minigame < server/db/migrations/add_user_generated_cards.sql
```

è¯¦ç»†è¯´æ˜ï¼š
- [æ—¶ä»£ä¸eventsç³»ç»Ÿæ–‡æ¡£](docs/æ—¶ä»£ä¸eventsç³»ç»Ÿ.md)
- [ç”¨æˆ·ç”Ÿæˆå¡ç‰Œç³»ç»Ÿæ–‡æ¡£](docs/ç”¨æˆ·ç”Ÿæˆå¡ç‰Œç³»ç»Ÿ.md)

## ğŸ”§ æŠ€æœ¯æ ˆ

### å‰ç«¯
- React 19 + Vite
- Phaser 3.60.0ï¼ˆReact å®¹å™¨å†…è¿è¡Œï¼‰
- å•é¡µåº”ç”¨è·¯ç”± + Token ä¼šè¯ä¿æŒ
- æ¶²æ€æ¯›ç»ç’ƒæ·±è‰² HUDã€ç§»åŠ¨ç«¯è™šæ‹Ÿæ‘‡æ†

### åç«¯
- Node.js 20 LTS + Express
- PostgreSQL 14ï¼ˆä¸»å­˜å‚¨ï¼‰
- Redis 6ï¼ˆç¼“å­˜+é™æµï¼‰
- Socket.ioï¼ˆå¤šäººé¢„ç•™ï¼‰

### AI æœåŠ¡
- OpenAI GPT-4ï¼ˆå¯é€‰ï¼‰
- DALL-E 3 å›¾ç‰‡ç”Ÿæˆï¼ˆå¯é€‰ï¼‰

## ğŸ”§ ç®¡ç†å‘˜åŠŸèƒ½

### å¡ç‰Œæ•°æ®åº“ç®¡ç†

ç®¡ç†å‘˜å¯ä»¥é€šè¿‡ **å¤§å… â†’ è®¾ç½® â†’ å¡ç‰Œæ•°æ®åº“** è®¿é—®ç®¡ç†ç•Œé¢ï¼ˆè·¯ç”±ï¼š`/cardsdatabase/`ï¼‰

**åŠŸèƒ½ï¼š**
- æŸ¥çœ‹æ‰€æœ‰å¡ç‰Œï¼ˆåŸºç¡€å¡ç‰Œ + ç”¨æˆ·ç”Ÿæˆå¡ç‰Œï¼‰
- æŒ‰æ¥æºã€æ—¶ä»£ã€ç±»å‹ç­›é€‰
- åˆ›å»ºæ–°çš„åŸºç¡€å¡ç‰Œ
- ç¼–è¾‘å¡ç‰Œä¿¡æ¯
- åˆ é™¤å¡ç‰Œï¼ˆç”¨æˆ·ç”Ÿæˆå¡ç‰Œå—ä¿æŠ¤ï¼‰
- å®æ—¶ç»Ÿè®¡ï¼šåŸºç¡€å¡ç‰Œæ•°ã€ç”¨æˆ·ç”Ÿæˆå¡ç‰Œæ•°

**å¡ç‰Œç³»ç»Ÿç‰¹ç‚¹ï¼š**
- æ‰€æœ‰ç‹¬ç‰¹å¡ç‰Œå­˜å‚¨åœ¨ `cards` è¡¨
- ç”¨æˆ·èƒŒåŒ…åªå­˜å‚¨å¡ç‰ŒIDå¼•ç”¨
- ç”¨æˆ·åˆæˆçš„æ–°å¡ç‰Œè‡ªåŠ¨åŠ å…¥å…¨å±€å¡ç‰Œæ± 
- å…¶ä»–ç”¨æˆ·åˆæˆåŒåå¡ç‰Œä¼šå¤ç”¨å·²å­˜åœ¨è®°å½•
- è¯¦è§ï¼š[ç”¨æˆ·ç”Ÿæˆå¡ç‰Œç³»ç»Ÿæ–‡æ¡£](docs/ç”¨æˆ·ç”Ÿæˆå¡ç‰Œç³»ç»Ÿ.md)

## ğŸ›¡ï¸ å®‰å…¨ç‰¹æ€§

- JWT è®¤è¯ï¼ˆ7å¤©æœ‰æ•ˆæœŸï¼‰
- Argon2 å¯†ç å“ˆå¸Œ
- ç™»å½•é™æµï¼ˆ5æ¬¡/åˆ†é’Ÿ/IPï¼‰
- åˆæˆé™æµï¼ˆ10æ¬¡/åˆ†é’Ÿ/ç”¨æˆ·ï¼‰
- å›¾ç‰‡ç”Ÿæˆé™æµï¼ˆ2æ¬¡/åˆ†é’Ÿ/ç”¨æˆ·ï¼‰
- ç®¡ç†å‘˜æƒé™ä¸­é—´ä»¶
- Helmet å®‰å…¨å¤´
- Zod è¾“å…¥æ ¡éªŒ

## ğŸ“ é¡¹ç›®æ¶æ„

### æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     å®¢æˆ·ç«¯å±‚ (Client)                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   React UI   â”‚  â”‚  Phaser 3   â”‚  â”‚  State Hook â”‚  â”‚
â”‚  â”‚  ç»„ä»¶ç³»ç»Ÿ    â”‚  â”‚  æ¸¸æˆå¼•æ“    â”‚  â”‚  çŠ¶æ€ç®¡ç†    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ HTTP/WebSocket
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     æœåŠ¡ç«¯å±‚ (Server)                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Express API â”‚  â”‚  ä¸šåŠ¡é€»è¾‘    â”‚  â”‚  æ¸¸æˆå¼•æ“    â”‚  â”‚
â”‚  â”‚  è·¯ç”±å±‚      â”‚  â”‚  Services    â”‚  â”‚  Gameplay   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚              â”‚              â”‚
         â–¼              â–¼              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PostgreSQL  â”‚  â”‚    Redis     â”‚  â”‚   OpenAI     â”‚
â”‚  ä¸»æ•°æ®åº“    â”‚  â”‚  ç¼“å­˜/é™æµ   â”‚  â”‚  AIæœåŠ¡      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç›®å½•ç»“æ„

```
/root/minigame/
â”œâ”€â”€ client/                      # React + Phaser å‰ç«¯åº”ç”¨
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ App.jsx              # åº”ç”¨æ ¹ç»„ä»¶ï¼ˆè·¯ç”±/çŠ¶æ€ï¼‰
â”‚   â”‚   â”œâ”€â”€ main.jsx             # React å…¥å£
â”‚   â”‚   â”œâ”€â”€ PhaserGame.jsx       # Phaser å®¹å™¨ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ components/          # UI ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ auth/           # ç™»å½•/æ³¨å†Œ
â”‚   â”‚   â”‚   â”œâ”€â”€ lobby/          # å¤§å…ï¼ˆå…­è¾¹å½¢åœ°å›¾ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ game/           # æ¸¸æˆå†…ç»„ä»¶
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ HUD.jsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ CardsPanel.jsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ForgePanel.jsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ InventoryPanel.jsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ProfessionPanel.jsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ContractPanel.jsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ BottomControls.jsx
â”‚   â”‚   â”‚   â””â”€â”€ common/         # é€šç”¨ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ game/                # Phaser æ¸¸æˆé€»è¾‘
â”‚   â”‚   â”‚   â”œâ”€â”€ MainScene.js    # ä¸»åœºæ™¯ï¼ˆä¸–ç•Œç½‘æ ¼/å•ä½ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ EventBus.js     # React-Phaser äº‹ä»¶æ¡¥
â”‚   â”‚   â”‚   â””â”€â”€ startGame.js    # Phaser å¯åŠ¨é…ç½®
â”‚   â”‚   â”œâ”€â”€ hooks/               # React Hooks
â”‚   â”‚   â”‚   â””â”€â”€ useGameSimulation.js  # å•æœºæ¸¸æˆçŠ¶æ€æ¨¡æ‹Ÿ
â”‚   â”‚   â”œâ”€â”€ data/                # é™æ€æ•°æ®å®šä¹‰
â”‚   â”‚   â”‚   â”œâ”€â”€ cards.js        # å¡ç‰Œç”Ÿæˆé€»è¾‘
â”‚   â”‚   â”‚   â”œâ”€â”€ professions.js  # èŒä¸šæ•°æ®
â”‚   â”‚   â”‚   â”œâ”€â”€ contracts.js    # å¥‘çº¦æ¨¡æ¿
â”‚   â”‚   â”‚   â””â”€â”€ inventory.js    # èƒŒåŒ…ç‰©å“
â”‚   â”‚   â”œâ”€â”€ services/            # API æœåŠ¡å°è£…
â”‚   â”‚   â”‚   â””â”€â”€ api.js          # HTTP è¯·æ±‚å°è£…
â”‚   â”‚   â””â”€â”€ styles/             # å…¨å±€æ ·å¼
â”‚   â”‚       â””â”€â”€ app.css         # æ¶²æ€æ¯›ç»ç’ƒä¸»é¢˜
â”‚   â”œâ”€â”€ public/                 # é™æ€èµ„æº
â”‚   â”‚   â”œâ”€â”€ assets/2d/          # 2D ç¾æœ¯èµ„æº
â”‚   â”‚   â””â”€â”€ favicon.png
â”‚   â”œâ”€â”€ vite/                   # Vite é…ç½®
â”‚   â””â”€â”€ dist/                   # æ„å»ºè¾“å‡ºï¼ˆç”Ÿäº§ï¼‰
â”‚
â”œâ”€â”€ server/                      # Express åç«¯æœåŠ¡
â”‚   â”œâ”€â”€ index.js                # æœåŠ¡å™¨å…¥å£
â”‚   â”œâ”€â”€ config/                 # é…ç½®æ¨¡å—
â”‚   â”‚   â””â”€â”€ env.js              # ç¯å¢ƒå˜é‡ç®¡ç†
â”‚   â”œâ”€â”€ db/                     # æ•°æ®åº“å±‚
â”‚   â”‚   â”œâ”€â”€ connection.js       # PostgreSQL è¿æ¥æ± 
â”‚   â”‚   â”œâ”€â”€ redis.js            # Redis å®¢æˆ·ç«¯
â”‚   â”‚   â”œâ”€â”€ schema.sql          # æ•°æ®åº“è¡¨ç»“æ„
â”‚   â”‚   â””â”€â”€ create-admin.js     # ç®¡ç†å‘˜åˆ›å»ºè„šæœ¬
â”‚   â”œâ”€â”€ routes/                 # API è·¯ç”±å±‚
â”‚   â”‚   â”œâ”€â”€ auth.js             # è®¤è¯è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ inventory.js        # èƒŒåŒ…è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ synthesize.js       # åˆæˆè·¯ç”±
â”‚   â”‚   â”œâ”€â”€ deck.js             # ç‰Œåº“è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ turn.js             # å›åˆè·¯ç”±
â”‚   â”‚   â”œâ”€â”€ world.js            # ä¸–ç•Œè·¯ç”±
â”‚   â”‚   â”œâ”€â”€ contract.js         # å¥‘çº¦è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ blueprint.js        # è“å›¾è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ image.js            # å›¾ç‰‡ç”Ÿæˆè·¯ç”±
â”‚   â”‚   â”œâ”€â”€ profession.js       # èŒä¸šè·¯ç”±
â”‚   â”‚   â””â”€â”€ admin.js            # ç®¡ç†è·¯ç”±
â”‚   â”œâ”€â”€ services/               # ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”‚   â”œâ”€â”€ authService.js      # è®¤è¯æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ inventoryService.js # èƒŒåŒ…æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ synthService.js     # åˆæˆè§„åˆ™å¼•æ“
â”‚   â”‚   â”œâ”€â”€ aiService.js        # AI åˆæˆæœåŠ¡
â”‚   â”‚   â”œâ”€â”€ imageService.js     # å›¾ç‰‡ç”ŸæˆæœåŠ¡
â”‚   â”‚   â””â”€â”€ professionService.js # èŒä¸šæœåŠ¡
â”‚   â”œâ”€â”€ gameplay/               # æ¸¸æˆé€»è¾‘å±‚
â”‚   â”‚   â”œâ”€â”€ deckService.js      # æŠ½ç‰Œ/æ´—ç‰Œ
â”‚   â”‚   â”œâ”€â”€ blueprintService.js # è“å›¾ç”Ÿæˆ
â”‚   â”‚   â”œâ”€â”€ worldService.js     # ä¸–ç•Œæ²™ç›˜
â”‚   â”‚   â”œâ”€â”€ contractService.js   # ç¤¾ä¼šå¥‘çº¦
â”‚   â”‚   â”œâ”€â”€ resourceService.js  # èµ„æºè®¡ç®—
â”‚   â”‚   â””â”€â”€ turnService.js      # å›åˆæ¨è¿›
â”‚   â”œâ”€â”€ rules/                  # è§„åˆ™å®šä¹‰
â”‚   â”‚   â””â”€â”€ customRules.js      # è‡ªå®šä¹‰åˆæˆè§„åˆ™
â”‚   â”œâ”€â”€ sockets/                # WebSocketï¼ˆé¢„ç•™ï¼‰
â”‚   â”‚   â””â”€â”€ index.js            # Socket.io åˆå§‹åŒ–
â”‚   â””â”€â”€ utils/                  # å·¥å…·å‡½æ•°
â”‚       â”œâ”€â”€ validators.js       # Zod æ ¡éªŒ
â”‚       â”œâ”€â”€ logger.js           # Pino æ—¥å¿—
â”‚       â””â”€â”€ security.js         # å®‰å…¨ä¸­é—´ä»¶ï¼ˆJWT/é™æµï¼‰
â”‚
â”œâ”€â”€ package.json                # æ ¹ä¾èµ–é…ç½®
â”œâ”€â”€ .env                        # ç¯å¢ƒå˜é‡
â”œâ”€â”€ setup.sh                   # ä¸€é”®å®‰è£…è„šæœ¬
â”œâ”€â”€ start.sh                   # å¼€å‘å¯åŠ¨è„šæœ¬
â”œâ”€â”€ start-production.sh         # ç”Ÿäº§å¯åŠ¨è„šæœ¬
â”œâ”€â”€ check-server.sh             # æœåŠ¡å¥åº·æ£€æŸ¥
â”œâ”€â”€ nginx.conf                  # Nginx é…ç½®æ¨¡æ¿
â””â”€â”€ README.md                   # é¡¹ç›®æ–‡æ¡£
```

### æ•°æ®æµ

#### è®¤è¯æµç¨‹
```
ç”¨æˆ·è¾“å…¥ â†’ AuthScreen â†’ api.js â†’ /api/auth/login â†’ authService â†’ PostgreSQL
   â†“
Token + User â†’ localStorage â†’ App.jsx â†’ GameShell/Lobby
```

#### æ¸¸æˆæµç¨‹ï¼ˆå•æœºæ¨¡æ‹Ÿï¼‰
```
ç”¨æˆ·æ“ä½œ â†’ Reactç»„ä»¶ â†’ useGameSimulation Hook â†’ æœ¬åœ°çŠ¶æ€æ›´æ–°
   â†“
åˆæˆå®Œæˆ â†’ forgeResultToInventoryItem â†’ inventory çŠ¶æ€ â†’ InventoryPanel å±•ç¤º
   â†“
å›åˆç»“æŸ â†’ endTurn â†’ èµ„æºæ›´æ–° + å¥‘çº¦ç”Ÿæˆ â†’ HUD åˆ·æ–°
```

#### Phaser äº¤äº’
```
React äº‹ä»¶ â†’ EventBus.emit('forge:flash') â†’ MainScene.handleForgeFlash
   â†“
Phaser åœºæ™¯æ›´æ–° â†’ è„‰å†²åŠ¨ç”» â†’ è§†è§‰åé¦ˆ
```

### çŠ¶æ€ç®¡ç†

- **å‰ç«¯**ï¼šReact Context + Hooksï¼ˆ`useGameSimulation` ç®¡ç†æ¸¸æˆçŠ¶æ€ï¼‰
- **åç«¯**ï¼šPostgreSQLï¼ˆæŒä¹…åŒ–ï¼‰+ Redisï¼ˆç¼“å­˜/é™æµï¼‰
- **ä¼šè¯**ï¼šJWT Tokenï¼ˆ7å¤©æœ‰æ•ˆæœŸï¼Œå­˜å‚¨åœ¨ localStorageï¼‰

### å…³é”®è®¾è®¡æ¨¡å¼

1. **å‰åç«¯åˆ†ç¦»**ï¼šReact SPA + Express REST API
2. **ç»„ä»¶åŒ–**ï¼šUI æ‹†åˆ†ä¸ºç‹¬ç«‹ç»„ä»¶ï¼ŒèŒè´£æ¸…æ™°
3. **Hooks æŠ½è±¡**ï¼šæ¸¸æˆé€»è¾‘å°è£…åœ¨ `useGameSimulation`ï¼Œä¾¿äºæµ‹è¯•å’Œå¤ç”¨
4. **äº‹ä»¶é©±åŠ¨**ï¼šReact â†” Phaser é€šè¿‡ EventBus é€šä¿¡
5. **æ•°æ®é©±åŠ¨**ï¼šé™æ€æ•°æ®ï¼ˆcards/professions/contractsï¼‰é›†ä¸­ç®¡ç†

## ğŸ”Œ API ç«¯ç‚¹

### è®¤è¯
- `POST /api/auth/register` - æ³¨å†Œ
- `POST /api/auth/login` - ç™»å½•
- `GET /api/auth/me` - è·å–å½“å‰ç”¨æˆ·

### æ¸¸æˆ
- `GET /api/deck/draw?count=3` - æŠ½ç‰Œ
- `POST /api/synthesize` - åˆæˆç‰©å“
- `POST /api/turn/end` - ç»“æŸå›åˆ
- `GET /api/turn/resources` - è·å–èµ„æº
- `GET /api/world/state` - è·å–ä¸–ç•ŒçŠ¶æ€
- `POST /api/contract/choose` - é€‰æ‹©å¥‘çº¦

### èƒŒåŒ…
- `GET /api/inventory` - è·å–èƒŒåŒ…
- `POST /api/inventory/add` - æ·»åŠ ç‰©å“
- `POST /api/inventory/remove` - ç§»é™¤ç‰©å“

## ğŸ¯ å¼€å‘è·¯çº¿å›¾

### M0ï¼ˆå·²å®Œæˆï¼‰
- âœ… è®¤è¯ç³»ç»Ÿ
- âœ… å››é˜¶æ®µå›åˆå¾ªç¯
- âœ… å¡ç‰ŒæŠ½å–
- âœ… åˆæˆç³»ç»Ÿï¼ˆè§„åˆ™+AIï¼‰
- âœ… èµ„æºç®¡ç†
- âœ… ä¸–ç•Œæ²™ç›˜
- âœ… ç¤¾ä¼šå¥‘çº¦
- âœ… ç§»åŠ¨ç«¯é€‚é…

### M1ï¼ˆè®¡åˆ’ä¸­ï¼‰
- è“å›¾ç³»ç»Ÿå®Œå–„
- äº‹ä»¶ç³»ç»Ÿæ‰©å±•
- æ—¥å¿—å’Œç¼“å­˜ä¼˜åŒ–
- å›¾ç‰‡ç”Ÿæˆé›†æˆ

### M2ï¼ˆè®¡åˆ’ä¸­ï¼‰
- å¤šäººå®æ—¶å¯¹æˆ˜
- PWA ç¦»çº¿æ”¯æŒ
- CDN èµ„æºä¼˜åŒ–
- å®ä¼Ÿå·¥ç¨‹å¯è§†åŒ–

## ğŸ› æ•…éšœæ’æŸ¥

### ç«¯å£è¢«å ç”¨
```bash
# ä¿®æ”¹ .env ä¸­çš„ PORT é…ç½®
PORT=3001
```

### æ•°æ®åº“è¿æ¥å¤±è´¥
```bash
# æ£€æŸ¥ PostgreSQL çŠ¶æ€
sudo systemctl status postgresql

# é‡å¯ PostgreSQL
sudo systemctl restart postgresql
```

### Redis è¿æ¥å¤±è´¥
```bash
# æ£€æŸ¥ Redis çŠ¶æ€
sudo systemctl status redis-server

# é‡å¯ Redis
sudo systemctl restart redis-server
```

## ğŸ“ è®¸å¯è¯

MIT

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

